spring:
  config:
    activate:
      on-profile: prod
  cloud:
    gateway:
      routes:
        # User Service Route
        - id: user-service
          uri: lb://BE-UserService
          predicates:
            - Path=/gateway/users/**
          filters:
            - StripPrefix=2
            - TokenRelay= # TokenRelay 필터를 사용하여 OAuth2 토큰을 백엔드 서비스로 전달
            - name: RequestRateLimiter
              args:
                rate-limiter: "#{@userServiceRateLimiter}"
                key-resolver: "#{@userKeyResolver}"
            - name: CircuitBreaker
              args:
                name: userSvcCb
                fallback-uri: forward:/fallback/user-service

        # API Management Service Routes
        - id: api-management-service
          uri: lb://BE-APIManagementService
          predicates:
            - Path=/gateway/apimgmt/**
          filters:
            - StripPrefix=2
            - TokenRelay=
            - name: RequestRateLimiter
              args:
                rate-limiter: "#{@managementServiceRateLimiter}"
                key-resolver: "#{@userKeyResolver}"
            - name: CircuitBreaker
              args:
                name: apiMgmtSvcCb
                fallback-uri: forward:/fallback/api-management

        # Custom API Management Service Routes
        - id: custom-api-management-service
          uri: lb://BE-CustomAPIManagementService
          predicates:
            - Path=/gateway/customapi/**
          filters:
            - StripPrefix=2
            - TokenRelay=
            - name: RequestRateLimiter
              args:
                rate-limiter: "#{@managementServiceRateLimiter}"
                key-resolver: "#{@userKeyResolver}"
            - name: CircuitBreaker
              args:
                name: customApiMgmtSvcCb
                fallback-uri: forward:/fallback/custom-api-management

        # AI Feature Service Routes
        - id: ai-feature-service
          uri: lb://BE-AIFeatureService
          predicates:
            - Path=/gateway/aifeature/**
          filters:
            - StripPrefix=2
            - TokenRelay=
            - name: RequestRateLimiter
              args:
                rate-limiter: "#{@aiServiceRateLimiter}"
                key-resolver: "#{@userKeyResolver}"
            - name: CircuitBreaker
              args:
                name: aiFeatureSvcCb
                fallback-uri: forward:/fallback/ai-feature

        # System Management Service Routes
        - id: system-management-service
          uri: lb://BE-SystemManagementService
          predicates:
            - Path=/gateway/sysmgmt/**
          filters:
            - StripPrefix=2
            - TokenRelay=
            - name: RequestRateLimiter
              args:
                rate-limiter: "#{@managementServiceRateLimiter}"
                key-resolver: "#{@userKeyResolver}"
            - name: CircuitBreaker
              args:
                name: systemMgmtSvcCb
                fallback-uri: forward:/fallback/system-management

management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus,metrics,gateway
  endpoint:
    gateway:
      access: read_only

